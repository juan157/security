# Spawning Shells

## Upgrading to a TTY-shell

If you have a non-tty-shell there are certain commands and stuff you can't do. This can happen if you upload reverse shells on a webserver, so that the shell you get is by the user www-data, or similar. These users are not meant to have shells as they don't interact with the system has humans do.

So if you don't have a tty-shell you can't run `su`, `sudo` for example. This can be annoying if you manage to get a root password but you can't use it.

Anyways, if you get one of these shells you can upgrade it to a tty-shell using the following methods:

**Using python**

```text
python -c 'import pty; pty.spawn("/bin/sh")'
```

**Echo**

```text
echo 'os.system('/bin/bash')'
```

**sh**

```text
/bin/sh -i
```

**bash**

```text
/bin/bash -i
```

**Perl**

```text
perl -e 'exec "/bin/sh";'
```

**From within VI**

```text
:!bash
```

## Upgrading TTY-shell to an Interactive TTY-shell

So if you manage to upgrade to a non-interactive tty-shell you will still have a limited shell. You won't be able to use the up and down arrows, you won't have tab-completion. This might be really frustrating if you stay in that shell for long. It can also be more risky, if a execution gets stuck you cant use Ctr-C or Ctr-Z without killing your session. However that can be fixed using socat. Follow these instructions.

{% embed data="{\"url\":\"https://github.com/cornerpirate/socat-shell\",\"type\":\"link\",\"title\":\"cornerpirate/socat-shell\",\"description\":\"socat-shell - Socat can be used to establish a reverse shell with bash tab completion and full shell functionality\",\"icon\":{\"type\":\"icon\",\"url\":\"https://github.com/fluidicon.png\",\"aspectRatio\":0},\"thumbnail\":{\"type\":\"thumbnail\",\"url\":\"https://avatars0.githubusercontent.com/u/4266127?s=400&v=4\",\"width\":400,\"height\":400,\"aspectRatio\":1}}" %}

## Socat Cheat Sheet

### Client-Server TCP Connections

```text
# Server
$ socat TCP-LISTEN:8800,reuseaddr,pf=ip4,fork -

# Client
$ socat TCP:localhost:8800 -
```

### SSL/TLS Server TCP Connecitons

**Server**

```text
$ socat OPENSSL-LISTEN:4443,reuseaddr,pf=ip4,fork,cert=$HOME/tmp/server.pem,cafile=$HOME/tmp/client.pem -
```

**Client**

```text
socat OPENSSL:localhost:4443,verify=0,cert=$HOME/tmp/client.pem,cafile=$HOME/tmp/server.pem -
```

### Unix Domain Socket Communication

**Server**

```text
socat UNIX-LISTEN:/usr/local/var/run/test/test.sock -
```

**Client**

```text
socat UNIX-CONNECT:/usr/local/var/run/test/test.sock -
```

Create a UNIX domain socket for IPC \(inter-process communication\) with **mutliple \(bi-directional\)** endpoints.

**Server**

```text
socat UNIX-LISTEN:/usr/local/var/run/test/test.sock\
,fork -
```

**Client**

```text
socat UNIX-CONNECT:/usr/local/var/run/test/test.sock -
```

Create UNIX domain sockets for IPC \(inter-process communication\) and **save the communication output to file**.

**Server**

```text
socat UNIX-LISTEN:/usr/local/var/run/test/test.sock,fork - \
>> $HOME/tmp/socketoutput.txt
```

**Client**

```text
socat UNIX-CONNECT:/usr/local/var/run/test/test.sock -
```

### Command Execution

Execute **shell** commands on a remote server \(i.e. basic ssh client\).

**Server**

```text
socat TCP-LISTEN:1234 EXEC:/bin/bash
```

**Client**

```text
socat TCP:localhost:1234 -
```

### Tunneling

Create an encrypted tunnel between a local computer and a remote machine to relay services created through an **SSH** protocol connection.

**Server**

```text
socat TCP-LISTEN:54321\
,reuseaddr\
,fork \
TCP:remote.server.com:22
```

**Client**

```text
ssh root@localhost -p 54321
```

Create a virtual point-to-point IP link through a **TUN** network device.

> **Mac OS X**: requires the [TunTap](http://tuntaposx.sourceforge.net/) kernel extensions.

**Server**

```text
socat /dev/tun0 -
```

**Client**

```text
ifconfig tun0 10.0.0.2 10.0.0.3
ping 10.0.0.3
```

## References:

[http://unix.stackexchange.com/questions/122616/why-do-i-need-a-tty-to-run-sudo-if-i-can-sudo-without-a-password](http://unix.stackexchange.com/questions/122616/why-do-i-need-a-tty-to-run-sudo-if-i-can-sudo-without-a-password) [http://netsec.ws/?p=337](http://netsec.ws/?p=337) [http://pentestmonkey.net/blog/post-exploitation-without-a-tty](http://pentestmonkey.net/blog/post-exploitation-without-a-tty)

